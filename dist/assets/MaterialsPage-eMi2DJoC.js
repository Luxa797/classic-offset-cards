import{r as i,E as e,I as z,Z as Ne,a7 as Y,J as ee,_ as T,P as K,$ as te,R as Q,a0 as C,a4 as ke}from"./index-DM-CIWAp.js";import{C as O}from"./Card-Cs5NGpgY.js";import{B as p}from"./Button-CSkHMulG.js";import{I as k}from"./Input-C5fRLLhS.js";import{S as A}from"./Select-BRlx7a9F.js";import{F as we}from"./filter-fEcCECdL.js";import{S as Se}from"./search-CuRiBKad.js";import{E as W}from"./eye-DucQexOi.js";import{S as G}from"./square-pen-Ctp6C1gD.js";import{T as J}from"./trash-2-BDU6yBnr.js";import{A as H}from"./arrow-up-down-quOBe8kM.js";import{P as X}from"./package-2-DlfEITOp.js";import{C as se}from"./check-circle-WE0OQaYY.js";import{M as $}from"./Modal-vVolvInd.js";import{T as ae}from"./TextArea-JRPRJW7n.js";import{l as Ce}from"./activityLogger-D_imCEB0.js";import{T as re,R as Te}from"./trending-up-hsClnWHh.js";import{T as qe}from"./tag-B0K0DeuI.js";import{U as Oe}from"./user-BVJ2pSL9.js";import{M as Me}from"./map-pin-BEsdh5VF.js";import{C as Z}from"./calendar-BnS4Q6u9.js";import{H as Fe}from"./history-CnJ7OVOR.js";import{M as Ae}from"./minus-ChEvdgBp.js";import{P as le}from"./plus-Bdy1EMzm.js";import{C as De}from"./ConfirmationModal-K-Eb6b0a.js";const Ie=({materials:d,categories:f,suppliers:t,loading:o,currentPage:r,totalPages:_,filters:l,onFiltersChange:y,onPageChange:a,onEdit:m,onView:n,onTransaction:h,onDelete:j})=>{const q=[{value:"IN_STOCK",label:"In Stock"},{value:"LOW_STOCK",label:"Low Stock"},{value:"OUT_OF_STOCK",label:"Out of Stock"}],M=i.useMemo(()=>f.map(s=>({value:s.name,label:s.name})),[f]),g=i.useMemo(()=>t.map(s=>({value:s.name,label:s.name})),[t]),v=s=>{switch(s){case"IN_STOCK":return e.jsx(se,{className:"w-4 h-4 text-green-500"});case"LOW_STOCK":return e.jsx(z,{className:"w-4 h-4 text-yellow-500"});case"OUT_OF_STOCK":return e.jsx(X,{className:"w-4 h-4 text-red-500"});default:return null}},b=s=>{switch(s){case"IN_STOCK":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"LOW_STOCK":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"OUT_OF_STOCK":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},u=()=>{y({category:"",supplier:"",stockStatus:"",search:""})},S=()=>e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((s,U)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"})]},U))})}),N=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(X,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No materials found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm",children:Object.values(l).some(s=>s)?"No materials match your current filters.":"Get started by adding your first material."}),Object.values(l).some(s=>s)&&e.jsx(p,{variant:"outline",size:"sm",onClick:u,className:"mt-3",children:"Clear Filters"})]}),D=()=>_<=1?null:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Page ",r," of ",_]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>a(r-1),disabled:r===1,children:"Previous"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>a(r+1),disabled:r===_,children:"Next"})]})]});return e.jsxs(O,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Material Inventory"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(we,{size:16}),d.length," materials"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"}),e.jsx(k,{id:"search-materials",placeholder:"Search materials...",value:l.search,onChange:s=>y({...l,search:s.target.value}),className:"pl-10"})]}),e.jsx(A,{id:"category-filter",label:"",options:M,value:l.category,onChange:s=>y({...l,category:s.target.value}),placeholder:"All Categories"}),e.jsx(A,{id:"supplier-filter",label:"",options:g,value:l.supplier,onChange:s=>y({...l,supplier:s.target.value}),placeholder:"All Suppliers"}),e.jsx(A,{id:"stock-status-filter",label:"",options:q,value:l.stockStatus,onChange:s=>y({...l,stockStatus:s.target.value}),placeholder:"All Stock Status"}),e.jsx(p,{variant:"outline",onClick:u,className:"w-full",children:"Clear Filters"})]})]}),o?e.jsx(S,{}):e.jsxs("div",{children:[e.jsx("div",{className:"md:hidden p-4 space-y-3",children:d.length>0?d.map(s=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-gray-800 dark:text-white",children:s.material_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.category_name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>n(s),title:"View",children:e.jsx(W,{size:16})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m(s),title:"Edit",children:e.jsx(G,{size:16})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>j(s),title:"Delete",children:e.jsx(J,{size:16,className:"text-red-500"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Quantity:"})," ",s.current_quantity," ",s.unit_of_measurement]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Value:"})," â‚¹",s.total_value.toLocaleString("en-IN")]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${b(s.stock_status)}`,children:[v(s.stock_status),s.stock_status.replace("_"," ")]})})]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx(p,{size:"sm",variant:"outline",onClick:()=>h(s),className:"flex-1",children:"Add Transaction"})})]},s.id)):e.jsx(N,{})}),e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Material Name",e.jsx(H,{size:14})]})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Supplier"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700 dark:text-gray-300",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700 dark:text-gray-300",children:"Unit Cost"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700 dark:text-gray-300",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700 dark:text-gray-300",children:"Stock Status"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700 dark:text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.length>0?d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:s.material_name}),s.description&&e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:s.description})]})}),e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:s.category_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:s.supplier_name||"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[s.current_quantity," ",s.unit_of_measurement]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Min: ",s.minimum_stock_level]})]}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium text-gray-900 dark:text-white",children:["â‚¹",s.cost_per_unit.toLocaleString("en-IN")]}),e.jsxs("td",{className:"px-4 py-3 text-right font-bold text-green-600 dark:text-green-400",children:["â‚¹",s.total_value.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${b(s.stock_status)}`,children:[v(s.stock_status),s.stock_status.replace("_"," ")]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>n(s),title:"View Material",children:e.jsx(W,{size:14})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>m(s),title:"Edit Material",children:e.jsx(G,{size:14})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>h(s),title:"Add Transaction",children:e.jsx(H,{size:14})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>j(s),title:"Delete Material",children:e.jsx(J,{size:14,className:"text-red-500"})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:e.jsx(N,{})})})})]})}),e.jsx(D,{})]})]})},ze=({isOpen:d,onClose:f,onSave:t,editingMaterial:o,categories:r,suppliers:_,isLoading:l})=>{const{userProfile:y}=Ne(),[a,m]=i.useState({material_name:"",description:"",category_id:"",supplier_id:"",unit_of_measurement:"pieces",current_quantity:"",minimum_stock_level:"",cost_per_unit:"",storage_location:"",purchase_date:""}),[n,h]=i.useState(null);i.useEffect(()=>{d&&(m(o?{material_name:o.material_name,description:o.description||"",category_id:o.category_id||"",supplier_id:o.supplier_id||"",unit_of_measurement:o.unit_of_measurement,current_quantity:String(o.current_quantity),minimum_stock_level:String(o.minimum_stock_level),cost_per_unit:String(o.cost_per_unit),storage_location:o.storage_location||"",purchase_date:o.purchase_date||""}:{material_name:"",description:"",category_id:"",supplier_id:"",unit_of_measurement:"pieces",current_quantity:"0",minimum_stock_level:"0",cost_per_unit:"0",storage_location:"",purchase_date:""}),h(null))},[d,o]);const j=u=>{const{id:S,value:N}=u.target;m({...a,[S]:N}),n&&h(null)},q=()=>a.material_name.trim()?a.unit_of_measurement.trim()?parseFloat(a.current_quantity)<0?"Current quantity cannot be negative":parseFloat(a.minimum_stock_level)<0?"Minimum stock level cannot be negative":parseFloat(a.cost_per_unit)<0?"Cost per unit cannot be negative":null:"Unit of measurement is required":"Material name is required",M=async u=>{u.preventDefault(),h(null);const S=q();if(S){h(S);return}try{const N={material_name:a.material_name.trim(),description:a.description.trim()||void 0,category_id:a.category_id||void 0,supplier_id:a.supplier_id||void 0,unit_of_measurement:a.unit_of_measurement.trim(),current_quantity:parseFloat(a.current_quantity),minimum_stock_level:parseFloat(a.minimum_stock_level),cost_per_unit:parseFloat(a.cost_per_unit),storage_location:a.storage_location.trim()||void 0,purchase_date:a.purchase_date||void 0,version:(o==null?void 0:o.version)||1,is_active:!0};await t(N);const D=(y==null?void 0:y.name)||"Admin",s=o?`Updated material: "${N.material_name}"`:`Added a new material: "${N.material_name}" with an initial quantity of ${N.current_quantity} ${N.unit_of_measurement}`;await Ce(s,D)}catch(N){h(N.message||"Failed to save material")}},g=[{value:"pieces",label:"Pieces"},{value:"kg",label:"Kilograms"},{value:"grams",label:"Grams"},{value:"liters",label:"Liters"},{value:"meters",label:"Meters"},{value:"sheets",label:"Sheets"},{value:"boxes",label:"Boxes"},{value:"rolls",label:"Rolls"},{value:"bottles",label:"Bottles"},{value:"packs",label:"Packs"}],v=r.map(u=>({value:u.id,label:u.name})),b=_.map(u=>({value:u.id,label:u.name}));return e.jsx($,{isOpen:d,onClose:f,title:o?"Edit Material":"Add New Material",size:"2xl",children:e.jsxs("form",{onSubmit:M,className:"space-y-4 pt-2",children:[n&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md text-sm",children:[e.jsx(Y,{size:18}),e.jsx("span",{children:n})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(k,{id:"material_name",label:"Material Name *",value:a.material_name,onChange:j,required:!0,disabled:l,placeholder:"e.g., A4 Paper, Black Ink Cartridge"}),e.jsx(A,{id:"category_id",label:"Category",options:v,value:a.category_id,onChange:j,disabled:l,placeholder:"Select category"})]}),e.jsx(ae,{id:"description",label:"Description",value:a.description,onChange:j,disabled:l,placeholder:"Brief description of the material...",rows:2}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{id:"supplier_id",label:"Supplier",options:b,value:a.supplier_id,onChange:j,disabled:l,placeholder:"Select supplier"}),e.jsx(k,{id:"storage_location",label:"Storage Location",value:a.storage_location,onChange:j,disabled:l,placeholder:"e.g., Warehouse A, Shelf 3"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(k,{id:"current_quantity",label:"Current Quantity *",type:"number",step:"0.01",min:"0",value:a.current_quantity,onChange:j,required:!0,disabled:l}),e.jsx(k,{id:"minimum_stock_level",label:"Minimum Stock Level *",type:"number",step:"0.01",min:"0",value:a.minimum_stock_level,onChange:j,required:!0,disabled:l}),e.jsx(A,{id:"unit_of_measurement",label:"Unit of Measurement *",options:g,value:a.unit_of_measurement,onChange:j,required:!0,disabled:l})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(k,{id:"cost_per_unit",label:"Cost per Unit (â‚¹) *",type:"number",step:"0.01",min:"0",value:a.cost_per_unit,onChange:j,required:!0,disabled:l}),e.jsx(k,{id:"purchase_date",label:"Purchase Date",type:"date",value:a.purchase_date,onChange:j,disabled:l})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"outline",onClick:f,disabled:l,children:"Cancel"}),e.jsx(p,{type:"submit",variant:"primary",disabled:l,children:l?e.jsx(ee,{className:"w-5 h-5 animate-spin"}):o?"Update Material":"Save Material"})]})]})})},Ue=({isOpen:d,onClose:f,material:t})=>{const[o,r]=i.useState([]),[_,l]=i.useState(!1);i.useEffect(()=>{d&&t&&y()},[d,t]);const y=async()=>{if(t){l(!0);try{const{data:n,error:h}=await T.from("material_transactions").select("*").eq("material_id",t.id).order("transaction_date",{ascending:!1}).limit(10);if(h)throw h;r(n||[])}catch(n){console.error("Failed to fetch transactions:",n)}finally{l(!1)}}};if(!d||!t)return null;const a=n=>{switch(n){case"IN_STOCK":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"LOW_STOCK":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"OUT_OF_STOCK":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},m=n=>{switch(n){case"IN":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"OUT":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"ADJUSTMENT":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return e.jsx($,{isOpen:d,onClose:f,title:t.material_name,size:"2xl",children:e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(K,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Current Quantity"}),e.jsxs("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:[t.current_quantity," ",t.unit_of_measurement]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(re,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Minimum Stock Level"}),e.jsxs("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:[t.minimum_stock_level," ",t.unit_of_measurement]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(te,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Cost per Unit"}),e.jsxs("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:["â‚¹",t.cost_per_unit.toLocaleString("en-IN")]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[t.category_name&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Category"}),e.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:t.category_name})]})]}),t.supplier_name&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(Oe,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Supplier"}),e.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:t.supplier_name}),t.supplier_contact&&e.jsx("p",{className:"text-xs text-gray-500",children:t.supplier_contact})]})]}),t.storage_location&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(Me,{className:"w-5 h-5 text-red-600 dark:text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Storage Location"}),e.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:t.storage_location})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Stock Status"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${a(t.stock_status)}`,children:t.stock_status.replace("_"," ")})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["â‚¹",t.total_value.toLocaleString("en-IN")]})]})]}),t.description&&e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:t.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.purchase_date&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(Z,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Purchase Date"}),e.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:new Date(t.purchase_date).toLocaleDateString("en-GB")})]})]}),t.last_purchase_date&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(Z,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Last Purchase"}),e.jsx("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:new Date(t.last_purchase_date).toLocaleDateString("en-GB")})]})]})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h4",{className:"font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5"}),"Recent Transactions"]})}),e.jsx("div",{className:"p-4",children:_?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading transactions..."}):o.length>0?e.jsx("div",{className:"space-y-3",children:o.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${m(n.transaction_type)}`,children:n.transaction_type}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:[n.quantity>0?"+":"",n.quantity," ",t.unit_of_measurement]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(n.transaction_date).toLocaleDateString("en-GB")})]})]}),n.total_cost&&e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-medium text-gray-800 dark:text-gray-100",children:["â‚¹",n.total_cost.toLocaleString("en-IN")]})})]},n.id))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No transactions found"})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(p,{variant:"outline",onClick:f,children:"Close"})})]})})},Le=({isOpen:d,onClose:f,material:t,onSuccess:o})=>{const[r,_]=i.useState({transaction_type:"IN",quantity:"",unit_cost:"",total_cost:"",reference_number:"",notes:"",transaction_date:new Date().toISOString().split("T")[0]}),[l,y]=i.useState(!1),[a,m]=i.useState(null);Q.useEffect(()=>{d&&t&&(_({transaction_type:"IN",quantity:"",unit_cost:String(t.cost_per_unit),total_cost:"",reference_number:"",notes:"",transaction_date:new Date().toISOString().split("T")[0]}),m(null))},[d,t]),Q.useEffect(()=>{const g=parseFloat(r.quantity)||0,v=parseFloat(r.unit_cost)||0,b=g*v;g>0&&v>0?_(u=>({...u,total_cost:b.toFixed(2)})):_(u=>({...u,total_cost:""}))},[r.quantity,r.unit_cost]);const n=g=>{const{id:v,value:b}=g.target;_({...r,[v]:b}),a&&m(null)},h=()=>{if(!r.transaction_type)return"Transaction type is required";if(!r.quantity||parseFloat(r.quantity)<=0)return"Quantity must be greater than zero";if(r.transaction_type==="OUT"&&t){const g=parseFloat(r.quantity);if(g>t.current_quantity)return`Cannot remove ${g} ${t.unit_of_measurement}. Only ${t.current_quantity} available.`}return null},j=async g=>{g.preventDefault(),m(null);const v=h();if(v){m(v);return}if(t){y(!0);try{const b={material_id:t.id,transaction_type:r.transaction_type,quantity:parseFloat(r.quantity),unit_cost:r.unit_cost?parseFloat(r.unit_cost):null,total_cost:r.total_cost?parseFloat(r.total_cost):null,reference_number:r.reference_number.trim()||null,notes:r.notes.trim()||null,transaction_date:r.transaction_date},{error:u}=await T.from("material_transactions").insert([b]);if(u)throw u;C.success("Transaction recorded successfully"),o()}catch(b){m(b.message||"Failed to record transaction")}finally{y(!1)}}},q=[{value:"IN",label:"Stock In (Add)"},{value:"OUT",label:"Stock Out (Remove)"},{value:"ADJUSTMENT",label:"Adjustment"}],M=g=>{switch(g){case"IN":return e.jsx(le,{className:"w-4 h-4 text-green-500"});case"OUT":return e.jsx(Ae,{className:"w-4 h-4 text-red-500"});case"ADJUSTMENT":return e.jsx(Te,{className:"w-4 h-4 text-blue-500"});default:return null}};return!d||!t?null:e.jsx($,{isOpen:d,onClose:f,title:`Add Transaction - ${t.material_name}`,size:"lg",children:e.jsxs("form",{onSubmit:j,className:"space-y-4 pt-2",children:[a&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md text-sm",children:[e.jsx(Y,{size:18}),e.jsx("span",{children:a})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"Current Stock Information"}),e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-300",children:["Available: ",e.jsxs("span",{className:"font-semibold",children:[t.current_quantity," ",t.unit_of_measurement]}),t.minimum_stock_level>0&&e.jsxs("span",{className:"ml-4",children:["Minimum: ",e.jsxs("span",{className:"font-semibold",children:[t.minimum_stock_level," ",t.unit_of_measurement]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:"Transaction Type *"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{id:"transaction_type",value:r.transaction_type,onChange:n,required:!0,disabled:l,className:"w-full px-3 py-2 pl-10 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",children:q.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:M(r.transaction_type)})]})]}),e.jsx(k,{id:"transaction_date",label:"Transaction Date *",type:"date",value:r.transaction_date,onChange:n,required:!0,disabled:l})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(k,{id:"quantity",label:`Quantity (${t.unit_of_measurement}) *`,type:"number",step:"0.01",min:"0.01",value:r.quantity,onChange:n,required:!0,disabled:l,placeholder:"Enter quantity"}),e.jsx(k,{id:"unit_cost",label:"Unit Cost (â‚¹)",type:"number",step:"0.01",min:"0",value:r.unit_cost,onChange:n,disabled:l,placeholder:"Cost per unit"}),e.jsx(k,{id:"total_cost",label:"Total Cost (â‚¹)",type:"number",step:"0.01",min:"0",value:r.total_cost,onChange:n,disabled:l,placeholder:"Auto-calculated"})]}),e.jsx(k,{id:"reference_number",label:"Reference Number",value:r.reference_number,onChange:n,disabled:l,placeholder:"e.g., PO-2024-001, Invoice #123"}),e.jsx(ae,{id:"notes",label:"Notes",value:r.notes,onChange:n,disabled:l,placeholder:"Additional notes about this transaction...",rows:3}),r.quantity&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Transaction Preview"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Action:"})," ",r.transaction_type==="IN"?"Add":r.transaction_type==="OUT"?"Remove":"Adjust"," ",r.quantity," ",t.unit_of_measurement]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"New Quantity:"})," ",r.transaction_type==="IN"?t.current_quantity+parseFloat(r.quantity||"0"):r.transaction_type==="OUT"?t.current_quantity-parseFloat(r.quantity||"0"):parseFloat(r.quantity||"0")," ",t.unit_of_measurement]}),r.total_cost&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Cost:"})," â‚¹",parseFloat(r.total_cost).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"outline",onClick:f,disabled:l,children:"Cancel"}),e.jsx(p,{type:"submit",variant:"primary",disabled:l,children:l?e.jsx(ee,{className:"w-5 h-5 animate-spin"}):"Record Transaction"})]})]})})},Ee=()=>{const[d,f]=i.useState([]),[t,o]=i.useState(!0);i.useEffect(()=>{r()},[]);const r=async()=>{o(!0);try{const{data:a,error:m}=await T.from("material_stock_alerts").select(`
          *,
          materials!inner(material_name, current_quantity, unit_of_measurement)
        `).eq("is_resolved",!1).order("created_at",{ascending:!1}).limit(5);if(m)throw m;f(a||[])}catch(a){console.error("Failed to fetch stock alerts:",a)}finally{o(!1)}},_=async a=>{try{const{error:m}=await T.from("material_stock_alerts").update({is_resolved:!0,resolved_at:new Date().toISOString()}).eq("id",a);if(m)throw m;f(n=>n.filter(h=>h.id!==a))}catch(m){console.error("Failed to resolve alert:",m)}},l=a=>{switch(a){case"LOW_STOCK":return e.jsx(z,{className:"w-5 h-5 text-yellow-500"});case"OUT_OF_STOCK":return e.jsx(K,{className:"w-5 h-5 text-red-500"});default:return e.jsx(z,{className:"w-5 h-5 text-orange-500"})}},y=a=>{switch(a){case"LOW_STOCK":return"border-l-yellow-500 bg-yellow-50 dark:bg-yellow-900/20";case"OUT_OF_STOCK":return"border-l-red-500 bg-red-50 dark:bg-red-900/20";default:return"border-l-orange-500 bg-orange-50 dark:bg-orange-900/20"}};return t?e.jsx(O,{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})})}):d.length===0?e.jsx(O,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(se,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("h3",{className:"font-medium text-gray-800 dark:text-white",children:"All Stock Levels Good"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No stock alerts at this time."})]})}):e.jsx(O,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-yellow-500"}),"Stock Alerts (",d.length,")"]}),e.jsx("div",{className:"space-y-3",children:d.map(a=>{var m;return e.jsx("div",{className:`p-3 border-l-4 rounded-r-lg ${y(a.alert_type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[l(a.alert_type),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white",children:(m=a.material)==null?void 0:m.material_name}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:a.message}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(a.created_at).toLocaleDateString("en-GB")})]})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>_(a.id),title:"Mark as resolved",children:e.jsx(ke,{size:16})})]})},a.id)})}),d.length>=5&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx(p,{variant:"link",size:"sm",children:"View All Alerts"})})]})})},mt=()=>{const[d,f]=i.useState([]),[t,o]=i.useState([]),[r,_]=i.useState([]),[l,y]=i.useState(!0),[a,m]=i.useState(!1),[n,h]=i.useState(!1),[j,q]=i.useState(!1),[M,g]=i.useState(!1),[v,b]=i.useState(!1),[u,S]=i.useState(null),[N,D]=i.useState(null),[s,U]=i.useState(null),[I,P]=i.useState(null),[L,ne]=i.useState(1),[ie,ce]=i.useState(1),[w,de]=i.useState({category:"",supplier:"",stockStatus:"",search:""}),F=i.useCallback(async(c=1)=>{y(!0);try{let x=T.from("materials_with_details").select("*",{count:"exact"}).order("created_at",{ascending:!1});w.category&&(x=x.eq("category_name",w.category)),w.supplier&&(x=x.eq("supplier_name",w.supplier)),w.stockStatus&&(x=x.eq("stock_status",w.stockStatus)),w.search&&(x=x.or(`material_name.ilike.%${w.search}%,description.ilike.%${w.search}%`));const E=10;x=x.range((c-1)*E,c*E-1);const{data:be,error:B,count:ve}=await x;if(B)throw B;f(be||[]),ce(Math.ceil((ve||0)/E)),ne(c)}catch(x){C.error(x.message||"Failed to fetch materials")}finally{y(!1)}},[w]),V=i.useCallback(async()=>{try{const{data:c,error:x}=await T.from("material_categories").select("*").order("name");if(x)throw x;o(c||[])}catch{C.error("Failed to fetch categories")}},[]),R=i.useCallback(async()=>{try{const{data:c,error:x}=await T.from("suppliers").select("*").eq("is_active",!0).order("name");if(x)throw x;_(c||[])}catch{C.error("Failed to fetch suppliers")}},[]);i.useEffect(()=>{F(),V(),R()},[F,V,R]);const oe=async c=>{m(!0);try{if(u){const{error:x}=await T.from("materials").update({...c,version:u.version+1}).eq("id",u.id);if(x)throw x;C.success("Material updated successfully")}else{const{error:x}=await T.from("materials").insert([c]);if(x)throw x;C.success("Material created successfully")}h(!1),S(null),F(L)}catch(x){x.code==="23505"?C.error("A material with this name already exists"):C.error(x.message||"Failed to save material")}finally{m(!1)}},me=c=>{S(c),h(!0)},xe=c=>{D(c),q(!0)},ue=c=>{U(c),g(!0)},ge=c=>{P(c),b(!0)},he=async()=>{if(I){m(!0);try{const{error:c}=await T.from("materials").update({is_active:!1}).eq("id",I.id);if(c)throw c;C.success("Material deleted successfully"),F(L)}catch(c){C.error(c.message||"Failed to delete material")}finally{m(!1),b(!1),P(null)}}},pe=()=>{g(!1),U(null),F(L)},ye=d.length,je=d.filter(c=>c.stock_status==="LOW_STOCK").length,fe=d.filter(c=>c.stock_status==="OUT_OF_STOCK").length,_e=d.reduce((c,x)=>c+x.total_value,0);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"ðŸ“¦ Materials Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Comprehensive material inventory and tracking system"})]}),e.jsxs(p,{onClick:()=>{S(null),h(!0)},className:"w-full sm:w-auto",children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," Add Material"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Materials"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:ye})]})]})}),e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-8 h-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Low Stock"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:je})]})]})}),e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:fe})]})]})}),e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-8 h-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["â‚¹",_e.toLocaleString("en-IN")]})]})]})})]}),e.jsx(Ee,{}),e.jsx(Ie,{materials:d,categories:t,suppliers:r,loading:l,currentPage:L,totalPages:ie,filters:w,onFiltersChange:de,onPageChange:c=>F(c),onEdit:me,onView:xe,onTransaction:ue,onDelete:ge}),e.jsx(ze,{isOpen:n,onClose:()=>h(!1),onSave:oe,editingMaterial:u,categories:t,suppliers:r,isLoading:a}),e.jsx(Ue,{isOpen:j,onClose:()=>q(!1),material:N}),e.jsx(Le,{isOpen:M,onClose:()=>g(!1),material:s,onSuccess:pe}),e.jsx(De,{isOpen:v,onClose:()=>b(!1),onConfirm:he,title:"Confirm Deletion",description:`Are you sure you want to delete "${I==null?void 0:I.material_name}"? This action will mark the material as inactive.`,confirmText:"Delete",isLoading:a})]})};export{mt as default};
