import{E as e,L as y,r as c,U as f,P as N,J as b,I as w,_ as D}from"./index-BrZuWI6n.js";import{C as m}from"./Card-xKmTyOZv.js";import{H as v}from"./hash-BpBMA1wf.js";import{B as k}from"./Button-Y7kV2YOr.js";import{l as O}from"./index-CizDwaz_.js";import{P}from"./printer-UXZF57t9.js";import{B as S,P as _}from"./party-popper-DZpWQb__.js";const E=({deliveryDate:r})=>{const d=new Date,o=new Date(r),t=Math.ceil((o.getTime()-d.getTime())/(1e3*60*60*24));let l="bg-green-200 text-green-800",i="Upcoming";return t<0?(l="bg-red-200 text-red-800",i="Overdue"):t<=3&&(l="bg-yellow-200 text-yellow-800",i="Due Soon"),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${l}`,children:i})},C=({customer:r,orders:d})=>{const o=d.reduce((t,l)=>t+(l.balance_due||0),0);return e.jsx(m,{children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:r}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Due"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-red-600 dark:text-red-400",children:["₹",o.toLocaleString("en-IN")]})]})]}),e.jsx("ul",{className:"mt-3 space-y-2 border-t border-gray-200 dark:border-gray-700 pt-3",children:d.map(t=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsxs(y,{to:`/invoices/${t.order_id}`,className:"flex items-center gap-2 text-primary-600 hover:underline",children:[e.jsx(v,{size:14}),e.jsxs("span",{children:["Order #",t.order_id]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["₹",t.balance_due.toLocaleString("en-IN")]}),e.jsx(E,{deliveryDate:t.date})]})]},t.order_id))})]})})},M=()=>{const[r,d]=c.useState([]),[o,t]=c.useState(!0),[l,i]=c.useState(null),g=c.useRef(null),h=O.useReactToPrint({content:()=>g.current,documentTitle:"Due Summary Report",pageStyle:"@media print { body { -webkit-print-color-adjust: exact; } .no-print { display: none; } }"});c.useEffect(()=>{(async()=>{t(!0),i(null);try{const{data:s,error:n}=await D.from("order_summary_with_dues").select("*").gt("balance_due",0).order("customer_name",{ascending:!0});if(n)throw n;d(s||[])}catch(s){console.error("❌ Error fetching due orders:",s),i(`Failed to load due summary. ${s.message}`)}finally{t(!1)}})()},[]);const u=c.useMemo(()=>{const a={};return r.forEach(s=>{const n=s.customer_name||"Unknown Customer";a[n]||(a[n]=[]),a[n].push(s)}),a},[r]),x=c.useMemo(()=>{const a=r.reduce((p,j)=>p+(j.balance_due||0),0),s=r.length,n=Object.keys(u).length;return{totalDueOverall:a,totalPendingOrders:s,totalCustomersWithDues:n}},[r,u]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 animate-slide-up",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-800 dark:text-white",children:" Due Summary"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pending payments grouped by customer."})]}),e.jsx("div",{className:"no-print",children:e.jsxs(k,{onClick:h,children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Export Due Summary"]})})]}),e.jsxs("div",{ref:g,className:"space-y-6",children:[!o&&r.length>0&&e.jsx(m,{children:e.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center p-2",children:[e.jsx(S,{className:"w-6 h-6 mb-1 text-red-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Total Due"}),e.jsxs("span",{className:"text-lg font-bold text-gray-800 dark:text-white",children:["₹",x.totalDueOverall.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex flex-col items-center p-2",children:[e.jsx(f,{className:"w-6 h-6 mb-1 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Customers with Dues"}),e.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-white",children:x.totalCustomersWithDues})]}),e.jsxs("div",{className:"flex flex-col items-center p-2",children:[e.jsx(N,{className:"w-6 h-6 mb-1 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Pending Orders"}),e.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-white",children:x.totalPendingOrders})]})]})}),o?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(b,{className:"w-8 h-8 animate-spin text-primary-500"}),e.jsx("p",{className:"ml-3 text-gray-500 dark:text-gray-400",children:"Loading due summary..."})]}):l?e.jsxs(m,{className:"p-6 bg-red-50 text-red-700 border border-red-300 text-center",children:[e.jsx(w,{className:"w-10 h-10 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:l})]}):x.totalCustomersWithDues===0?e.jsxs(m,{className:"p-12 text-center bg-green-50 dark:bg-green-900/30",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 text-green-500"}),e.jsx("p",{className:"font-semibold text-lg text-green-700 dark:text-green-200",children:"No Dues!"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-300",children:"All payments are up to date."})]}):Object.entries(u).map(([a,s])=>e.jsx(C,{customer:a,orders:s},a))]})]})};export{M as default};
