import{r as t,_ as d,E as e,P as f,I as j,ac as A,F as z,L as E,J as L}from"./index-DM-CIWAp.js";import{C as c}from"./Card-Cs5NGpgY.js";import{B as O}from"./Button-CSkHMulG.js";import{I as P}from"./Input-C5fRLLhS.js";import{d as m,r as T}from"./relativeTime-B6BWBmOc.js";import{S as F}from"./search-CuRiBKad.js";import{C as N}from"./check-circle-WE0OQaYY.js";m.extend(T);const o={Pending:{className:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300",icon:e.jsx(L,{size:14,className:"animate-spin"}),timelineColor:"bg-red-400"},Design:{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-300",icon:e.jsx(j,{size:14}),timelineColor:"bg-yellow-400"},Printing:{className:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",icon:e.jsx(f,{size:14}),timelineColor:"bg-blue-400"},Delivered:{className:"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300",icon:e.jsx(N,{size:14}),timelineColor:"bg-green-400"}},I=["All","Pending","Design","Printing"],q=()=>{const[x,v]=t.useState([]),[w,_]=t.useState(!0),[g,u]=t.useState(null),[r,k]=t.useState("All"),[l,C]=t.useState(""),n=t.useCallback(async()=>{u(null);try{const{data:s,error:a}=await d.rpc("get_orders_with_status_history");if(a)throw a;v(s||[])}catch(s){u(s.message||"Failed to load status overview.")}finally{_(!1)}},[]);t.useEffect(()=>{n();const s=d.channel("order_status_log_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"order_status_log"},a=>{console.log("New status change received!",a),n()}).subscribe();return()=>{d.removeChannel(s)}},[n]);const p=t.useMemo(()=>x.filter(s=>r==="All"||s.latest_status===r).filter(s=>{var a;return((a=s.customer_name)==null?void 0:a.toLowerCase().includes(l.toLowerCase()))||String(s.order_id).includes(l)}),[x,r,l]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-white flex items-center gap-2",children:[e.jsx(f,{size:24,className:"text-primary-600"}),"Status Overview"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Realtime timeline of all active orders."})]}),e.jsx("div",{className:"w-full sm:w-auto sm:max-w-xs relative",children:e.jsx(P,{id:"search-status",type:"search",placeholder:"Search Order# or Customer...",value:l,onChange:s=>C(s.target.value),icon:e.jsx(F,{size:16,className:"text-gray-400"}),className:"pl-9"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(s=>e.jsx(O,{variant:r===s?"primary":"outline",size:"sm",onClick:()=>k(s),children:s},s))}),w?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 animate-pulse",children:Array(3).fill(0).map((s,a)=>e.jsx("div",{className:"p-6 bg-gray-200 dark:bg-gray-700 rounded-lg h-40"},a))}):g?e.jsxs(c,{className:"p-6 text-center text-red-600 bg-red-50",children:[e.jsx(j,{className:"mx-auto h-10 w-10 mb-2"}),g]}):p.length===0?e.jsxs(c,{className:"p-12 text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30",children:[e.jsx(N,{className:"mx-auto h-12 w-12 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold",children:"All Caught Up!"}),e.jsx("p",{className:"text-sm",children:r==="All"?"There are no pending orders.":`No orders with status "${r}".`})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:e.jsx(A,{children:p.map((s,a)=>{var h,b;return e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:a*.05},children:e.jsxs(c,{className:"p-0 overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 sm:p-5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-800 dark:text-white",children:[e.jsxs(E,{to:`/orders/${s.order_id}`,className:"hover:underline",children:["Order #",s.order_id]}),e.jsx("span",{className:"block text-sm font-normal text-gray-500 dark:text-gray-400",children:s.customer_name})]}),e.jsxs("span",{className:`text-xs px-2.5 py-1 rounded-full font-medium flex items-center gap-1.5 whitespace-nowrap ${((h=o[s.latest_status])==null?void 0:h.className)||"bg-gray-100 text-gray-600"}`,children:[(b=o[s.latest_status])==null?void 0:b.icon,s.latest_status]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Last update ",m(s.last_updated_at).fromNow()," by ",e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s.last_updated_by})]})]}),e.jsx("div",{className:"flex-grow px-4 sm:px-5 pb-4",children:e.jsx("div",{className:"border-l-2 border-gray-300 dark:border-gray-600 pl-4 space-y-4",children:(s.history||[]).map((i,S)=>{var y;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-[23px] top-1.5 h-3 w-3 rounded-full border-4 border-white dark:border-gray-800 ${((y=o[i.status])==null?void 0:y.timelineColor)||"bg-gray-300"}`}),e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:i.status}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["by ",i.updated_by," â€¢ ",m(i.updated_at).fromNow()]})]},S)})})})]})},s.order_id)})})})]})};export{q as default};
