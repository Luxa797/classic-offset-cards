import{Z as ge,r,E as e,a7 as He,J as ee,_,a0 as q,a1 as qe,T as Ve,Y as Ke,a2 as Qe,I as G,L as ce,$ as re,aa as pe,ab as me}from"./index-DM-CIWAp.js";import{C as O}from"./Card-Cs5NGpgY.js";import{I as z}from"./Input-C5fRLLhS.js";import{S as J}from"./Select-BRlx7a9F.js";import{B as M}from"./Button-CSkHMulG.js";import{l as Je}from"./activityLogger-D_imCEB0.js";import{M as xe}from"./Modal-vVolvInd.js";import{C as ue}from"./ConfirmationModal-K-Eb6b0a.js";import{R as ye}from"./refresh-cw-DxPtey9L.js";import{D as je}from"./download-DMkQx4BI.js";import{S as fe}from"./search-CuRiBKad.js";import{U as We}from"./user-BVJ2pSL9.js";import{C as be}from"./calendar-BnS4Q6u9.js";import{C as Ne}from"./credit-card-C_T1-BHt.js";import{E as Ye}from"./eye-DucQexOi.js";import{S as ve}from"./square-pen-Ctp6C1gD.js";import{T as we}from"./trash-2-BDU6yBnr.js";import{F as Ze}from"./filter-fEcCECdL.js";import{A as Ge}from"./arrow-up-down-quOBe8kM.js";import{C as he}from"./clock-BhcPVGcX.js";import{P as Xe}from"./pie-chart-DJTW1_C2.js";import{C as et}from"./check-circle-WE0OQaYY.js";import{A as tt}from"./activity-B7zReUhT.js";import{H as _e}from"./history-CnJ7OVOR.js";import{P as at}from"./plus-Bdy1EMzm.js";import{L as st}from"./list-BvaC7IYr.js";import{P as rt}from"./plus-circle-CW7gMPuW.js";const nt=({onSuccess:l})=>{const{user:P,userProfile:T}=ge(),[R,U]=r.useState([]),[L,f]=r.useState([]),[A,$]=r.useState([]),[p,m]=r.useState(null),[s,I]=r.useState({customerId:"",orderId:"",totalAmount:"",amountPaid:"",dueDate:"",status:"Due",paymentDate:new Date().toISOString().split("T")[0],paymentMethod:"Cash",notes:""}),[a,i]=r.useState(!1),[b,N]=r.useState(null);r.useEffect(()=>{(async()=>{i(!0),N(null);try{const{data:n,error:h}=await _.from("customers").select("id, name, phone").order("name");if(h)throw h;U(n||[]);const{data:c,error:d}=await _.from("order_summary_with_dues").select("order_id, customer_id, customer_name, total_amount, amount_paid, balance_due").gt("balance_due",0).order("order_id",{ascending:!1});if(d)throw d;const g=(c||[]).map(S=>({id:S.order_id,customer_id:S.customer_id,customer_name:S.customer_name,total_amount:S.total_amount,amount_received:S.amount_paid,balance_amount:S.balance_due}));f(g)}catch(n){N("Failed to load initial data. Please refresh the page."),console.error("Error fetching initial data:",n)}finally{i(!1)}})()},[]);const y=u=>{const n=u.target.value;I({...s,customerId:n,orderId:"",totalAmount:"",amountPaid:""}),m(null),$(n?L.filter(h=>h.customer_id===n):[])},F=u=>{const n=u.target.value,h=n?parseInt(n,10):null;if(I(c=>({...c,orderId:n,totalAmount:"",amountPaid:""})),h){const c=L.find(d=>d.id===h);c&&(m(c),I(d=>({...d,totalAmount:String(c.total_amount||0),amountPaid:""})))}else m(null)},x=u=>{const{id:n,value:h}=u.target;I({...s,[n]:h})},v=(u,n)=>n>=u?"Paid":n>0?"Partial":"Due",E=async u=>{if(u.preventDefault(),!P||!p){N("User and order must be selected.");return}i(!0),N(null);const n=parseFloat(s.amountPaid);if(isNaN(n)||n<=0){N("Please enter a valid payment amount."),i(!1);return}try{const h={},{error:c}=await _.from("payments").insert([{customer_id:s.customerId,order_id:parseInt(s.orderId),total_amount:p.total_amount||0,amount_paid:n,due_date:s.dueDate||null,status:v(p.total_amount,n),payment_date:s.paymentDate,created_by:P.id,payment_method:s.paymentMethod,notes:s.notes||null}]);if(c)throw c;const d=(p.amount_received||0)+n,{error:g}=await _.from("orders").update({amount_received:d,balance_amount:(p.total_amount||0)-d}).eq("id",p.id);if(g)throw g;q.success("Payment recorded successfully!");const S=(T==null?void 0:T.name)||"Admin",te=`Received a payment of â‚¹${n.toLocaleString("en-IN")} for Order #${p.id} from ${p.customer_name}.`;await Je(te,S),await qe(Ve(Ke,"notifications"),{message:`Payment of â‚¹${n.toLocaleString("en-IN")} received for Order #${p.id}.`,type:"payment",relatedId:p.id,timestamp:Qe(),read:!1,triggeredBy:S}),l(),I({customerId:"",orderId:"",totalAmount:"",amountPaid:"",dueDate:"",status:"Due",paymentDate:new Date().toISOString().split("T")[0],paymentMethod:"Cash",notes:""}),m(null),$([])}catch(h){console.error("Error recording payment:",h),N(h.message||"Failed to record payment. Please try again."),q.error(h.message||"Failed to record payment.")}finally{i(!1)}};return e.jsx(O,{title:"Record New Payment",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[b&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md text-sm",children:[e.jsx(He,{size:18}),e.jsx("span",{children:b})]}),e.jsx(J,{id:"customerId",label:"Customer *",value:s.customerId,onChange:y,options:R.map(u=>({value:u.id,label:`${u.name}${u.phone?` (${u.phone})`:""}`})),placeholder:"Select a customer",required:!0,disabled:a}),e.jsx(J,{id:"orderId",label:"Order *",value:s.orderId,onChange:F,options:A.map(u=>({value:String(u.id),label:`Order #${u.id} - Due: â‚¹${u.balance_amount.toLocaleString("en-IN")}`})),placeholder:"Select an order",required:!0,disabled:!s.customerId||a}),p&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700",children:[e.jsx("h4",{className:"font-medium text-blue-800 dark:text-blue-200 mb-2",children:"Order Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:"Total:"}),e.jsxs("div",{className:"font-semibold",children:["â‚¹",(p.total_amount||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:"Paid:"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["â‚¹",(p.amount_received||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:"Due:"}),e.jsxs("div",{className:"font-semibold text-red-600",children:["â‚¹",(p.balance_amount||0).toLocaleString("en-IN")]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(z,{id:"totalAmount",label:"Total Amount (â‚¹)",type:"number",value:s.totalAmount,onChange:x,disabled:!0,required:!0,placeholder:"Total order amount"}),e.jsx(z,{id:"amountPaid",label:"Amount Being Paid (â‚¹) *",type:"number",value:s.amountPaid,onChange:x,required:!0,disabled:a||!p,placeholder:"Amount being paid now"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(z,{id:"paymentDate",label:"Payment Date *",type:"date",value:s.paymentDate,onChange:x,required:!0,disabled:a}),e.jsx(J,{id:"paymentMethod",label:"Payment Method",value:s.paymentMethod,onChange:x,options:[{value:"Cash",label:"Cash"},{value:"UPI",label:"UPI"},{value:"Bank Transfer",label:"Bank Transfer"}],disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes"}),e.jsx("textarea",{id:"notes",value:s.notes,onChange:x,disabled:a,rows:3,className:"w-full px-3 py-2 border rounded-lg shadow-sm bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600",placeholder:"Payment notes..."})]}),e.jsx(M,{type:"submit",variant:"primary",disabled:a||!p,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5 mr-2 animate-spin"}),"Recording..."]}):"Record Payment"})]})})},lt=()=>{const{user:l}=ge(),[P,T]=r.useState([]),[R,U]=r.useState(!0),[L,f]=r.useState(null),[A,$]=r.useState(""),[p,m]=r.useState(""),[s,I]=r.useState(""),[a,i]=r.useState({min:"",max:""}),[b,N]=r.useState("created_at"),[y,F]=r.useState("desc"),[x,v]=r.useState([]),[E,u]=r.useState(!1),[n,h]=r.useState(null),[c,d]=r.useState(null),[g,S]=r.useState(null),[te,X]=r.useState(!1),[ke,ne]=r.useState(!1),[Se,ae]=r.useState(!1),[Ce,se]=r.useState(!1),[C,K]=r.useState({amount_paid:"",due_date:"",status:"",payment_method:"",notes:""}),[le,De]=r.useState([]),[Pe,de]=r.useState(!1),Q=r.useCallback(async()=>{U(!0),f(null);try{const{data:t,error:o}=await _.from("payments").select(`
          *,
          customers (
            name,
            phone
          )
        `).order(b,{ascending:y==="asc"});if(o)throw o;const k=t.map(w=>w.order_id).filter(w=>w!==null);let D=[];if(k.length>0){const{data:w,error:j}=await _.from("order_summary_with_dues").select("order_id, total_amount, amount_paid, balance_due").in("order_id",k);if(j)throw j;D=w||[]}const H=(t||[]).map(w=>{const j=w.customers,B=D.find(ze=>ze.order_id===w.order_id),Re=(B==null?void 0:B.total_amount)||0,ie=(B==null?void 0:B.amount_paid)||0,Y=(B==null?void 0:B.balance_due)||0;let Z=w.status;return Y<=0?Z="Paid":ie>0&&Y>0?Z="Partial":w.due_date&&new Date(w.due_date)<new Date&&Y>0?Z="Overdue":Y>0&&(Z="Due"),{...w,customer_name:(j==null?void 0:j.name)||"Unknown Customer",customer_phone:(j==null?void 0:j.phone)||"",status:Z,order_total_amount:Re,order_amount_paid:ie,order_balance_due:Y}});T(H)}catch(t){f(t.message||"Failed to fetch payments"),q.error("Failed to load payments")}finally{U(!1)}},[b,y]),Le=async t=>{de(!0);try{const{data:o,error:k}=await _.from("payment_history").select("*").eq("payment_id",t).order("changed_at",{ascending:!1});if(k)throw k;De(o||[])}catch(o){console.error("Failed to fetch payment history:",o)}finally{de(!1)}};r.useEffect(()=>{Q()},[Q]);const V=r.useMemo(()=>P.filter(o=>{var j;const k=((j=o.customer_name)==null?void 0:j.toLowerCase().includes(A.toLowerCase()))||String(o.order_id).includes(A)||o.id.toLowerCase().includes(A.toLowerCase()),D=!p||o.status===p,H=!s||o.due_date.startsWith(s),w=(!a.min||o.amount_paid>=parseFloat(a.min))&&(!a.max||o.amount_paid<=parseFloat(a.max));return k&&D&&H&&w}),[P,A,p,s,a]),Ae=t=>{b===t?F(y==="asc"?"desc":"asc"):(N(t),F("desc"))},Ie=t=>{v(o=>o.some(D=>D.id===t.id)?o.filter(D=>D.id!==t.id):[...o,t])},Ee=()=>{v(E?[]:V),u(!E)},Oe=t=>{h(t),K({amount_paid:String(t.amount_paid),due_date:t.due_date,status:t.status,payment_method:t.payment_method||"",notes:t.notes||""}),X(!0)},Te=async()=>{if(!(!n||!(l!=null&&l.id)))try{const t={amount_paid:parseFloat(C.amount_paid),due_date:C.due_date,status:C.status,payment_method:C.payment_method,notes:C.notes,updated_at:new Date().toISOString()},{data:o,error:k,count:D}=await _.from("payments").update(t).eq("id",n.id).select();if(k)throw k;if(D&&D>0){const{error:H}=await _.from("payment_history").insert({payment_id:n.id,action:"UPDATE",old_data:n,new_data:{...n,...t,order_total_amount:n.order_total_amount,order_amount_paid:n.order_amount_paid,order_balance_due:n.order_balance_due},changed_by:l.id,notes:"Payment updated via management interface"});H&&console.error("Failed to log payment history:",H)}else throw new Error("Payment record not found or could not be updated");q.success("Payment updated successfully"),X(!1),h(null),Q()}catch(t){q.error(t.message||"Failed to update payment")}},Fe=t=>{d(t),ne(!0),Le(t.id)},Me=t=>{S(t),ae(!0)},Ue=async()=>{if(!(!g||!(l!=null&&l.id)))try{const{error:t}=await _.from("payment_history").delete().eq("payment_id",g.id);if(t)throw t;const{error:o}=await _.from("payments").delete().eq("id",g.id);if(o)throw o;q.success("Payment deleted successfully"),ae(!1),S(null),Q()}catch(t){q.error(t.message||"Failed to delete payment")}},$e=async()=>{if(!(x.length===0||!(l!=null&&l.id)))try{const t=x.map(D=>D.id),{error:o}=await _.from("payment_history").delete().in("payment_id",t);if(o)throw o;const{error:k}=await _.from("payments").delete().in("id",t);if(k)throw k;q.success(`${x.length} payments deleted successfully`),v([]),u(!1),se(!1),Q()}catch(t){q.error(t.message||"Failed to delete payments")}},Be=()=>{const t=["Payment ID","Customer","Order ID","Order Total","Amount Paid","Balance Due","Status","Due Date","Payment Method","Created Date"],o=V.map(j=>[j.id,j.customer_name,j.order_id,`â‚¹${j.order_total_amount}`,`â‚¹${j.amount_paid}`,`â‚¹${j.order_balance_due}`,j.status,new Date(j.due_date).toLocaleDateString(),j.payment_method||"-",new Date(j.created_at).toLocaleDateString()]),k=[t,...o].map(j=>j.map(B=>`"${B}"`).join(",")).join(`
`),D=new Blob([k],{type:"text/csv"}),H=window.URL.createObjectURL(D),w=document.createElement("a");w.href=H,w.download=`payments-export-${new Date().toISOString().split("T")[0]}.csv`,w.click(),window.URL.revokeObjectURL(H)},oe=t=>{switch(t){case"Paid":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"Partial":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"Overdue":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"Due":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},W=({field:t,children:o})=>e.jsxs("button",{onClick:()=>Ae(t),className:"flex items-center gap-1 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[o,e.jsx(Ge,{size:14,className:b===t?"text-primary-600 dark:text-primary-400":"text-gray-400"})]});return R?e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(ee,{className:"w-8 h-8 animate-spin text-primary-500"}),e.jsx("span",{className:"ml-2",children:"Loading payments..."})]})}):L?e.jsxs(O,{className:"p-6 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-700 text-center",children:[e.jsx(G,{className:"w-10 h-10 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"font-semibold",children:"Error Loading Payments"}),e.jsx("p",{className:"text-sm",children:L})]}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ’³ Payment Management"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Comprehensive payment tracking and management"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{onClick:Q,variant:"outline",size:"sm",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Refresh"]}),e.jsxs(M,{onClick:Be,variant:"outline",size:"sm",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Export CSV"]}),x.length>0&&e.jsxs(M,{onClick:()=>se(!0),variant:"destructive",size:"sm",children:["Delete Selected (",x.length,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"}),e.jsx(z,{id:"search-payments",placeholder:"Search payments...",value:A,onChange:t=>$(t.target.value),className:"pl-10"})]}),e.jsx(J,{id:"status-filter",label:"",options:[{value:"Paid",label:"Paid"},{value:"Partial",label:"Partial"},{value:"Due",label:"Due"},{value:"Overdue",label:"Overdue"}],value:p,onChange:t=>m(t.target.value),placeholder:"All Status"}),e.jsx(z,{id:"date-filter",type:"month",value:s,onChange:t=>I(t.target.value),placeholder:"Filter by month"}),e.jsx(z,{id:"min-amount",type:"number",placeholder:"Min amount",value:a.min,onChange:t=>i({...a,min:t.target.value})}),e.jsx(z,{id:"max-amount",type:"number",placeholder:"Max amount",value:a.max,onChange:t=>i({...a,max:t.target.value})}),e.jsx(M,{variant:"outline",onClick:()=>{$(""),m(""),I(""),i({min:"",max:""})},children:"Clear Filters"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:E,onChange:Ee,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:e.jsx(W,{field:"customer_name",children:"Customer"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium",children:e.jsx(W,{field:"order_total_amount",children:"Order Total"})}),e.jsx("th",{className:"px-4 py-3 text-right font-medium",children:e.jsx(W,{field:"amount_paid",children:"Amount Paid"})}),e.jsx("th",{className:"px-4 py-3 text-right font-medium",children:"Balance Due"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium",children:e.jsx(W,{field:"status",children:"Status"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:e.jsx(W,{field:"due_date",children:"Due Date"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:V.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:x.some(o=>o.id===t.id),onChange:()=>Ie(t),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.customer_name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customer_phone})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(ce,{to:`/invoices/${t.order_id}`,className:"text-primary-600 hover:text-primary-700 hover:underline",children:["#",t.order_id]})}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:["â‚¹",t.order_total_amount.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium text-green-600",children:["â‚¹",t.amount_paid.toLocaleString()]})," ",e.jsxs("td",{className:"px-4 py-3 text-right font-medium text-red-600",children:["â‚¹",t.order_balance_due.toLocaleString()]})," ",e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${oe(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:new Date(t.due_date).toLocaleDateString()})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:t.payment_method||"-"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>Fe(t),title:"View Details",children:e.jsx(Ye,{size:14})}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>Oe(t),title:"Edit Payment",children:e.jsx(ve,{size:14})}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>Me(t),title:"Delete Payment",children:e.jsx(we,{size:14,className:"text-red-500"})})]})})]},t.id))})]}),V.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No payments found matching your filters."})]})]}),V.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[e.jsxs("span",{children:["Showing ",V.length," of ",P.length," payments",x.length>0&&` â€¢ ${x.length} selected`]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{size:16}),e.jsxs("span",{children:["Total Value: â‚¹",V.reduce((t,o)=>t+o.amount_paid,0).toLocaleString()]})]})]})})]}),e.jsx(xe,{isOpen:te,onClose:()=>X(!1),title:`Edit Payment - ${n==null?void 0:n.customer_name}`,size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(z,{id:"amount_paid",label:"Amount Paid (â‚¹)",type:"number",step:"0.01",value:C.amount_paid,onChange:t=>K({...C,amount_paid:t.target.value})}),e.jsx(z,{id:"due_date",label:"Due Date",type:"date",value:C.due_date,onChange:t=>K({...C,due_date:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{id:"status",label:"Status",options:[{value:"Paid",label:"Paid"},{value:"Partial",label:"Partial"},{value:"Due",label:"Due"},{value:"Overdue",label:"Overdue"}],value:C.status,onChange:t=>K({...C,status:t.target.value})}),e.jsx(J,{id:"payment_method",label:"Payment Method",options:[{value:"Cash",label:"Cash"},{value:"UPI",label:"UPI"},{value:"Bank Transfer",label:"Bank Transfer"},{value:"Credit Card",label:"Credit Card"},{value:"Check",label:"Check"}],value:C.payment_method,onChange:t=>K({...C,payment_method:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notes"}),e.jsx("textarea",{value:C.notes,onChange:t=>K({...C,notes:t.target.value}),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",rows:3,placeholder:"Add any notes about this payment..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(M,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),e.jsx(M,{onClick:Te,children:"Save Changes"})]})]})}),e.jsx(xe,{isOpen:ke,onClose:()=>ne(!1),title:`Payment Details - ${c==null?void 0:c.customer_name}`,size:"2xl",children:c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white",children:"Payment Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Payment ID:"}),e.jsx("span",{className:"font-medium",children:c.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Order ID:"}),e.jsxs(ce,{to:`/invoices/${c.order_id}`,className:"text-primary-600 hover:underline",children:["#",c.order_id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Order Total:"}),e.jsxs("span",{className:"font-medium",children:["â‚¹",c.order_total_amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Amount Paid:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["â‚¹",c.amount_paid.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Balance Due:"}),e.jsxs("span",{className:"font-medium text-red-600",children:["â‚¹",c.order_balance_due.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${oe(c.status)}`,children:c.status})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white",children:"Customer & Dates"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"}),e.jsx("span",{className:"font-medium",children:c.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Phone:"}),e.jsx("span",{className:"font-medium",children:c.customer_phone})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Due Date:"}),e.jsx("span",{className:"font-medium",children:new Date(c.due_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("span",{className:"font-medium",children:new Date(c.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Payment Method:"}),e.jsx("span",{className:"font-medium",children:c.payment_method||"-"})]})]})]})]}),c.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:c.notes})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-3",children:"Payment History"}),Pe?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(ee,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"ml-2 text-sm",children:"Loading history..."})]}):le.length>0?e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:le.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.action}),e.jsx("span",{className:"text-gray-500 ml-2",children:t.notes})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.changed_at).toLocaleString()})]},t.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No history available"})]})]})}),e.jsx(ue,{isOpen:Se,onClose:()=>ae(!1),onConfirm:Ue,title:"Delete Payment",description:"Are you sure you want to delete this payment? This action cannot be undone.",confirmText:"Delete Payment"}),e.jsx(ue,{isOpen:Ce,onClose:()=>se(!1),onConfirm:$e,title:"Delete Multiple Payments",description:`Are you sure you want to delete ${x.length} selected payments? This action cannot be undone.`,confirmText:`Delete ${x.length} Payments`})]})},dt=()=>{const[l,P]=r.useState(null),[T,R]=r.useState([]),[U,L]=r.useState(!0),[f,A]=r.useState("30");r.useEffect(()=>{$()},[f]);const $=async()=>{L(!0);try{const m=new Date;m.setDate(m.getDate()-parseInt(f));const{data:s,error:I}=await _.from("order_summary_with_dues").select(`
          order_id,
          customer_name,
          total_amount,
          amount_paid,
          balance_due,
          date,
          delivery_date,
          due_status 
        `).gte("date",m.toISOString()).order("date",{ascending:!1});if(I)throw I;const{data:a,error:i}=await _.from("payments").select(`
          id,
          amount_paid,
          payment_method,
          created_at,
          customers (name)
        `).gte("created_at",m.toISOString());if(i)throw i;const b=(s==null?void 0:s.length)||0,N=(s==null?void 0:s.reduce((d,g)=>d+(g.total_amount||0),0))||0,y=(s==null?void 0:s.reduce((d,g)=>d+(g.amount_paid||0),0))||0,F=(s==null?void 0:s.reduce((d,g)=>d+(g.balance_due||0),0))||0,x=(s==null?void 0:s.reduce((d,g)=>d+(g.due_status==="Overdue"&&g.balance_due||0),0))||0,v=b>0?N/b:0,E=(s==null?void 0:s.reduce((d,g)=>((g.balance_due||0)<=0?d.paid+=1:g.due_status==="Overdue"?d.overdue+=1:g.due_status==="Due Soon"&&((g.amount_paid||0)>0?d.partial+=1:d.due+=1),d),{paid:0,partial:0,due:0,overdue:0}))||{paid:0,partial:0,due:0,overdue:0},u=new Date;u.setDate(u.getDate()-7);const n=(a==null?void 0:a.filter(d=>new Date(d.created_at)>u).length)||0,h=(a==null?void 0:a.reduce((d,g)=>{const S=g.payment_method||"Unknown";return d[S]=(d[S]||0)+1,d},{}))||{};P({totalOrders:b,totalRevenue:N,totalReceived:y,pendingAmount:F,overdueAmount:x,averageOrderValue:v,ordersByStatus:E,recentPayments:n,paymentMethods:h});const c=(a==null?void 0:a.map(d=>{var g;return{id:d.id,customer_name:((g=d.customers)==null?void 0:g.name)||"Unknown",amount_paid:d.amount_paid,status:"Paid",created_at:d.created_at}}).sort((d,g)=>new Date(g.created_at).getTime()-new Date(d.created_at).getTime()).slice(0,5))||[];R(c)}catch(m){console.error("Failed to fetch dashboard data:",m)}finally{L(!1)}},p=m=>{switch(m){case"Paid":return"text-green-600 dark:text-green-400";case"Partial":return"text-yellow-600 dark:text-yellow-400";case"Overdue":return"text-red-600 dark:text-red-400";case"Due":return"text-blue-600 dark:text-blue-400";default:return"text-gray-600 dark:text-gray-400"}};return U?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 animate-pulse",children:Array(8).fill(0).map((m,s)=>e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg"},s))}):l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"Payment Analytics"}),e.jsxs("select",{value:f,onChange:m=>A(m.target.value),className:"px-3 py-2 border rounded-lg text-sm bg-white dark:bg-gray-700 dark:text-white dark:border-gray-600",children:[e.jsx("option",{value:"7",children:"Last 7 days"}),e.jsx("option",{value:"30",children:"Last 30 days"}),e.jsx("option",{value:"90",children:"Last 90 days"}),e.jsx("option",{value:"365",children:"Last year"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(O,{className:"p-6 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(re,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Collected"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["â‚¹",l.totalReceived.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["from ",l.totalOrders," orders"]})]})]})}),e.jsx(O,{className:"p-6 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(he,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pending Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["â‚¹",l.pendingAmount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:[l.ordersByStatus.due+l.ordersByStatus.partial," orders pending"]})]})]})}),e.jsx(O,{className:"p-6 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Overdue Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["â‚¹",l.overdueAmount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:[l.ordersByStatus.overdue," overdue orders"]})]})]})}),e.jsx(O,{className:"p-6 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Average Order Value"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["â‚¹",l.averageOrderValue.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:[l.recentPayments," payments this week"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(O,{className:"p-6 bg-white dark:bg-gray-800",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Order Payment Status"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Fully Paid"})]}),e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:l.ordersByStatus.paid})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Partially Paid"})]}),e.jsx("span",{className:"font-bold text-yellow-600 dark:text-yellow-400",children:l.ordersByStatus.partial})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Payment Due"})]}),e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:l.ordersByStatus.due})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Overdue"})]}),e.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:l.ordersByStatus.overdue})]})]})]}),e.jsxs(O,{className:"p-6 bg-white dark:bg-gray-800",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(tt,{className:"w-5 h-5"}),"Recent Payment Transactions"]}),e.jsx("div",{className:"space-y-3",children:T.length>0?T.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:m.customer_name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(m.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-gray-900 dark:text-white",children:["â‚¹",m.amount_paid.toLocaleString()]}),e.jsx("p",{className:`text-xs font-medium ${p(m.status)}`,children:m.status})]})]},m.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(re,{className:"w-8 h-8 mx-auto"}),e.jsx("p",{children:"No recent payment transactions"})]})})]})]}),Object.keys(l.paymentMethods).length>0&&e.jsxs(O,{className:"p-6 bg-white dark:bg-gray-800",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Payment Methods Used"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(l.paymentMethods).map(([m,s])=>e.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"font-bold text-lg text-gray-900 dark:text-white",children:s}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:m})]},m))})]})]}):e.jsxs(O,{className:"p-6 text-center bg-white dark:bg-gray-800",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-gray-400 dark:text-gray-500"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Failed to load payment metrics"})]})},ot=()=>{const[l,P]=r.useState([]),[T,R]=r.useState(!0),[U,L]=r.useState(null),[f,A]=r.useState(""),$=r.useCallback(async()=>{R(!0),L(null);try{const{data:a,error:i}=await _.from("payment_history").select("*").order("changed_at",{ascending:!1}).limit(100);if(i)throw i;if(!a||a.length===0){P([]);return}const b=[...new Set(a.map(v=>v.changed_by).filter(Boolean))],{data:N,error:y}=await _.from("users").select("id, name").in("id",b);y&&console.warn("Could not fetch user names:",y);const F=(N||[]).reduce((v,E)=>(v[E.id]=E.name,v),{}),x=a.map(v=>{let E="Unknown",u=null,n=null;const h=v.new_values||v.old_values;return h&&(h.customer_name&&(E=h.customer_name),h.order_id&&(u=h.order_id),h.amount_paid?n=h.amount_paid:h.total_amount&&(n=h.total_amount)),{...v,user_name:F[v.changed_by]||"Unknown User",customer_name:E,order_id:u,amount:n}});P(x)}catch(a){console.error("Failed to fetch payment history:",a),L(a.message||"Could not load payment history")}finally{R(!1)}},[]);r.useEffect(()=>{$()},[$]);const p=r.useMemo(()=>{if(!f)return l;const a=f.toLowerCase();return l.filter(i=>{var b,N,y;return((b=i.user_name)==null?void 0:b.toLowerCase().includes(a))||((N=i.customer_name)==null?void 0:N.toLowerCase().includes(a))||String(i.order_id||"").includes(a)||i.action.toLowerCase().includes(a)||((y=i.notes)==null?void 0:y.toLowerCase().includes(a))})},[l,f]),m=a=>{switch(a){case"CREATE":return{icon:at,color:"text-green-600",bgColor:"bg-green-100 dark:bg-green-900/30"};case"UPDATE":return{icon:ve,color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900/30"};case"DELETE":return{icon:we,color:"text-red-600",bgColor:"bg-red-100 dark:bg-red-900/30"};default:return{icon:me,color:"text-gray-600",bgColor:"bg-gray-100 dark:bg-gray-700"}}},s=(a,i)=>{if(!a||!i)return null;const b=[],N=new Set([...Object.keys(a),...Object.keys(i)]);for(const y of N)y==="updated_at"||y==="created_at"||a[y]!==i[y]&&b.push(e.jsxs("li",{className:"text-xs",children:[e.jsxs("span",{className:"font-semibold capitalize",children:[y.replace("_"," "),":"]})," ",e.jsx("span",{className:"text-red-600 line-through",children:String(a[y]||"null")})," â†’ ",e.jsx("span",{className:"text-green-600",children:String(i[y]||"null")})]},y));return b.length>0?e.jsx("ul",{className:"mt-2 list-disc pl-5 space-y-1",children:b}):null},I=()=>{const a=["Date","Action","User","Customer","Order ID","Amount","Notes"],i=p.map(x=>[new Date(x.changed_at).toLocaleString(),x.action,x.user_name||"Unknown",x.customer_name||"Unknown",x.order_id||"-",x.amount?`â‚¹${x.amount}`:"-",x.notes||"-"]),b=[a,...i].map(x=>x.map(v=>`"${v}"`).join(",")).join(`
`),N=new Blob([b],{type:"text/csv"}),y=window.URL.createObjectURL(N),F=document.createElement("a");F.href=y,F.download=`payment-history-${new Date().toISOString().split("T")[0]}.csv`,F.click(),window.URL.revokeObjectURL(y)};return e.jsxs(O,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{size:20,className:"text-primary-600"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Payment History & Audit Log"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{onClick:$,variant:"outline",size:"sm",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Refresh"]}),e.jsxs(M,{onClick:I,variant:"outline",size:"sm",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Export CSV"]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-xs",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"}),e.jsx(z,{id:"search-history",placeholder:"Search by user, customer, order...",value:f,onChange:a=>A(a.target.value),className:"pl-10"})]})}),T?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(ee,{className:"animate-spin w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Loading payment history..."})]}):U?e.jsxs("div",{className:"text-center p-8 text-red-600",children:[e.jsx(G,{className:"mx-auto h-8 w-8 mb-2"}),e.jsx("p",{className:"font-semibold",children:"Error Loading History"}),e.jsx("p",{className:"text-sm",children:U})]}):e.jsx("div",{className:"space-y-6 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2",children:p.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"font-medium",children:"No payment history found"}),e.jsx("p",{className:"text-sm",children:f?"Try adjusting your search terms.":"Payment changes will appear here."})]}):p.map(a=>{const i=m(a.action);return e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${i.bgColor} border-l-current`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i.icon,{size:16,className:i.color}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 dark:text-white",children:[a.action," Payment Record"]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(a.changed_at).toLocaleString()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-300 mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User:"})," ",a.user_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",a.customer_name]}),a.order_id&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order:"})," #",a.order_id]}),a.amount&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," â‚¹",a.amount.toLocaleString()]})]}),a.notes&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",a.notes]}),a.action==="UPDATE"&&s(a.old_values,a.new_values)]})]})},a.id)})})]})]})},it=()=>{const[l,P]=r.useState("dashboard"),[T,R]=r.useState(0),U=()=>{R(f=>f+1),P("manage")},L=[{id:"dashboard",label:"Analytics",icon:pe},{id:"manage",label:"Manage Payments",icon:st},{id:"add",label:"Add Payment",icon:rt},{id:"history",label:"History & Audit",icon:_e}];return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"ðŸ’³ Payment Management System"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Comprehensive payment tracking, analytics, and management"})]})}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex space-x-8 overflow-x-auto",children:L.map(f=>{const A=f.icon;return e.jsxs("button",{onClick:()=>P(f.id),className:`flex items-center gap-2 px-3 py-2 text-sm font-medium transition-colors border-b-2 whitespace-nowrap ${l===f.id?"border-primary-600 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[e.jsx(A,{size:16}),f.label]},f.id)})})}),e.jsxs("div",{className:"mt-6",children:[l==="dashboard"&&e.jsx(dt,{}),l==="manage"&&e.jsx(lt,{},T),l==="add"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(nt,{onSuccess:U})}),l==="history"&&e.jsx(ot,{})]})]})},Mt=()=>e.jsx(it,{});export{Mt as default};
