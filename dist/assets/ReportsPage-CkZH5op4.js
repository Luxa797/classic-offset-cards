import{r as d,E as e,J as b,a4 as O,_ as m,a0 as v}from"./index-DM-CIWAp.js";import{C as y}from"./Card-Cs5NGpgY.js";import{I as h}from"./Input-C5fRLLhS.js";import{B as u}from"./Button-CSkHMulG.js";import{l as E}from"./index-BWLW3r6o.js";import{B as $}from"./bar-chart-nyLlCUbp.js";import{S as G}from"./search-CuRiBKad.js";import{D as z}from"./download-DMkQx4BI.js";import{A as H}from"./arrow-left-Bhiz6Alw.js";import{P as V}from"./printer-Db08zeDp.js";const q=[{value:"profit_loss",label:"Profit & Loss"},{value:"orders_list",label:"Orders List"},{value:"customers_list",label:"Customer List"},{value:"payment_details",label:"Payment Details"},{value:"due_summary",label:"Due Summary Report"},{value:"invoice_report",label:"Invoice Report"}],Q=({invoiceData:c,onBack:N})=>{var i;const s=d.useRef(null),{invoice:a,payments:o}=c,g=E.useReactToPrint({content:()=>s.current,documentTitle:`Invoice_${a.id}`,pageStyle:"@media print { body { -webkit-print-color-adjust: exact; } @page { size: A4; margin: 20mm; } }",onBeforeGetContent:()=>new Promise(n=>setTimeout(n,300))});return a?e.jsxs(y,{className:"mt-6 animate-slide-up",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b",children:[e.jsxs(u,{onClick:N,variant:"outline",children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," Back to List"]}),e.jsxs(u,{onClick:g,children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Download as PDF"]})]}),e.jsxs("div",{ref:s,className:"p-8 bg-white text-black",children:[e.jsxs("div",{className:"flex justify-between items-start pb-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Classic Offset cards"}),e.jsx("p",{className:"text-sm text-gray-500",children:"363, bazar road"}),e.jsx("p",{className:"text-sm text-gray-500",children:"kadayanallur -62775"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tenkasi District, Tamil Nadu."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-700",children:"INVOICE"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Invoice #: ",a.id]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Date: ",new Date(a.date).toLocaleDateString("en-GB")]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Bill To:"}),e.jsx("p",{className:"text-lg font-bold text-gray-800",children:a.customer_name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.customer_address||"N/A"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.customer_phone})]}),e.jsx("div",{className:"mt-8 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 text-left font-semibold text-gray-600",children:"Description"}),e.jsx("th",{className:"py-2 px-4 text-center font-semibold text-gray-600",children:"Quantity"}),e.jsx("th",{className:"py-2 px-4 text-right font-semibold text-gray-600",children:"Rate"}),e.jsx("th",{className:"py-2 px-4 text-right font-semibold text-gray-600",children:"Amount"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-3 px-4",children:a.order_type}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.quantity}),e.jsxs("td",{className:"py-3 px-4 text-right",children:["₹",((i=a.rate)==null?void 0:i.toLocaleString("en-IN"))||"0.00"]}),e.jsxs("td",{className:"py-3 px-4 text-right",children:["₹",a.total_amount.toLocaleString("en-IN")]})]})})]})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs("div",{className:"w-full max-w-xs space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-semibold text-gray-800",children:["₹",a.total_amount.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Paid:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["- ₹",(a.total_amount-a.balance_amount).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t text-lg",children:[e.jsx("span",{className:"font-bold text-gray-800",children:"Balance Due:"}),e.jsxs("span",{className:"font-bold text-red-600",children:["₹",a.balance_amount.toLocaleString("en-IN")]})]})]})}),o.length>0&&e.jsxs("div",{className:"mt-8 border-t pt-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Payment History:"}),e.jsx("ul",{className:"text-xs list-disc list-inside text-gray-600",children:o.map(n=>e.jsxs("li",{children:["Paid ₹",n.amount_paid.toLocaleString("en-IN")," via ",n.payment_method," on ",new Date(n.payment_date).toLocaleDateString("en-GB"),"."]},n.id))})]})]})]}):null},ae=()=>{const[c,N]=d.useState("profit_loss"),[s,a]=d.useState({startDate:"",endDate:"",orderStatus:"",searchTerm:"",sinceDate:"",customerName:"",orderNumber:"",orderId:""}),[o,g]=d.useState(!1),[i,n]=d.useState(null),[_,D]=d.useState([]),[k,x]=d.useState(null),[w,f]=d.useState(null),[L,S]=d.useState(!1),T=t=>{N(t),n(null),D([]),x(null),f(null),I()},j=t=>{a(r=>({...r,[t.target.id]:t.target.value}))},I=()=>{a({startDate:"",endDate:"",orderStatus:"",searchTerm:"",sinceDate:"",customerName:"",orderNumber:"",orderId:""})},R=async()=>{g(!0),n(null),x(null);try{let t=null,r=null,l=[];if(c==="invoice_report")({data:t,error:r}=await m.rpc("get_invoice_list",{p_start_date:s.startDate||null,p_end_date:s.endDate||null,p_customer_name:s.searchTerm||null,p_order_id:s.orderId?parseInt(s.orderId):null})),l=["Order ID","Date","Customer","Total","Due","Status"];else switch(c){case"profit_loss":({data:t,error:r}=await m.rpc("get_profit_loss_report",{start_date:s.startDate,end_date:s.endDate})),l=["Category","Amount (₹)"],t=t!=null&&t.length?[["Total Revenue",`+ ₹${t[0].total_revenue.toLocaleString("en-IN")}`],["Total Expenses",`- ₹${t[0].total_expenses.toLocaleString("en-IN")}`],["Net Profit",`₹${t[0].net_profit.toLocaleString("en-IN")}`]]:[];break;case"orders_list":({data:t,error:r}=await m.rpc("get_orders_report",{start_date:s.startDate,end_date:s.endDate,order_status:s.orderStatus})),l=["Order ID","Customer","Type","Qty","Amount","Status","Date"];break;case"due_summary":({data:t,error:r}=await m.rpc("get_due_summary_report")),l=["Order ID","Delivery Date","Balance Due (₹)"];break}if(r)throw r;n(t),D(l),(!t||t.length===0)&&v.success("No data found for the selected criteria.")}catch(t){v.error(`Report generation failed: ${t.message}`)}finally{g(!1)}},P=async t=>{x(t),S(!0),f(null);try{const{data:r,error:l}=await m.from("orders").select("*").eq("id",t).single();if(l)throw l;const{data:p,error:C}=await m.from("payments").select("*").eq("order_id",t);if(C)throw C;f({invoice:r,payments:p})}catch(r){v.error(`Failed to load invoice #${t}: ${r.message}`),x(null)}finally{S(!1)}},B=()=>{},A=()=>{switch(c){case"invoice_report":return e.jsxs("div",{className:"md:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsx(h,{id:"startDate",label:"From Date",type:"date",value:s.startDate,onChange:j}),e.jsx(h,{id:"endDate",label:"To Date",type:"date",value:s.endDate,onChange:j}),e.jsx(h,{id:"searchTerm",label:"Customer Name",value:s.searchTerm,onChange:j,placeholder:"Search name..."}),e.jsx(h,{id:"orderId",label:"Order Number",type:"number",value:s.orderId,onChange:j,placeholder:"Search ID..."})]});default:return e.jsx("div",{className:"md:col-span-3",children:e.jsx("p",{className:"text-sm text-gray-500 pt-6",children:"Select a report type to see filters."})})}},F=()=>o?e.jsx("div",{className:"p-8 text-center",children:e.jsx(b,{className:"w-8 h-8 animate-spin mx-auto"})}):c==="invoice_report"?L?e.jsx("div",{className:"p-8 text-center",children:e.jsx(b,{className:"w-8 h-8 animate-spin mx-auto"})}):k&&w?e.jsx(Q,{invoiceData:w,onBack:()=>x(null)}):i&&i.length>0?e.jsx(y,{className:"mt-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsx("tr",{children:_.map(t=>e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:t},t))})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:i.map(t=>e.jsxs("tr",{onClick:()=>P(t.order_id),className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsxs("td",{className:"px-4 py-2 font-bold",children:["#",t.order_id]}),e.jsx("td",{className:"px-4 py-2",children:new Date(t.order_date).toLocaleDateString("en-GB")}),e.jsx("td",{className:"px-4 py-2",children:t.customer_name}),e.jsxs("td",{className:"px-4 py-2",children:["₹",t.total_amount.toLocaleString("en-IN")]}),e.jsxs("td",{className:"px-4 py-2 text-red-600",children:["₹",t.balance_due.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-2",children:t.status||"N/A"})]},t.order_id))})]})})}):e.jsx("div",{className:"text-center p-6 text-gray-500",children:'Use the filters and click "Search Invoices" to begin.'}):i&&i.length>0?e.jsxs(y,{className:"mt-6",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold",children:"Report Preview"}),e.jsxs(u,{onClick:B,size:"sm",children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," Download as PDF"]})]}),e.jsx("div",{className:"overflow-x-auto p-2",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsx("tr",{children:_.map(t=>e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:t},t))})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:i.map((t,r)=>e.jsx("tr",{children:Array.isArray(t)?t.map((l,p)=>e.jsx("td",{className:"px-4 py-2",children:l},p)):Object.values(t).map((l,p)=>e.jsx("td",{className:"px-4 py-2",children:String(l)},p))},r))})]})})]}):null;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-white flex items-center gap-3",children:[e.jsx($,{})," Reports Center"]}),e.jsx(y,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsx(h,{as:"select",id:"reportType",label:"Report Type",value:c,onChange:t=>T(t.target.value),children:q.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),A()]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{onClick:R,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Working..."]}):c==="invoice_report"?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Search Invoices"]}):"Generate Report"}),e.jsxs(u,{onClick:I,variant:"outline",children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Clear"]})]})]})}),F()]})};export{ae as default};
