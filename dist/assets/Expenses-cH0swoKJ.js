import{r as l,E as e,Z as R,a7 as V,J as G,_ as D,a0 as A,a8 as W}from"./index-DM-CIWAp.js";import{C as O}from"./Card-Cs5NGpgY.js";import{B as b}from"./Button-CSkHMulG.js";import{I as F}from"./Input-C5fRLLhS.js";import{S as z}from"./Select-BRlx7a9F.js";import{F as J}from"./filter-fEcCECdL.js";import{S as X}from"./search-CuRiBKad.js";import{S as q}from"./square-pen-Ctp6C1gD.js";import{T as I}from"./trash-2-BDU6yBnr.js";import{T as Z}from"./tag-B0K0DeuI.js";import{C as H}from"./credit-card-C_T1-BHt.js";import{C as K}from"./calendar-BnS4Q6u9.js";import{F as Q}from"./file-x-DcB5xnML.js";import{A as Y,a as ee}from"./arrow-up-narrow-wide-CDZAbFM7.js";import{M as te}from"./Modal-vVolvInd.js";import{T as ae}from"./TextArea-JRPRJW7n.js";import{l as se}from"./activityLogger-D_imCEB0.js";import{C as re}from"./ConfirmationModal-K-Eb6b0a.js";import{P as le}from"./plus-Bdy1EMzm.js";const ne=({expenses:x,loading:C,onEdit:M,onDelete:n})=>{const[c,s]=l.useState(""),[p,i]=l.useState(""),[h,v]=l.useState(""),[r,u]=l.useState("date"),[g,_]=l.useState("desc"),[y,f]=l.useState(1),j=10,{categories:w,paymentMethods:a}=l.useMemo(()=>{const t=[...new Set(x.map(o=>o.expense_type))].sort(),m=[...new Set(x.map(o=>o.payment_method))].sort();return{categories:t.map(o=>({value:o,label:o})),paymentMethods:m.map(o=>({value:o,label:o}))}},[x]),d=l.useMemo(()=>{let t=x;if(c){const m=c.toLowerCase();t=t.filter(o=>o.expense_type.toLowerCase().includes(m)||o.paid_to.toLowerCase().includes(m)||o.notes&&o.notes.toLowerCase().includes(m))}return p&&(t=t.filter(m=>m.expense_type===p)),h&&(t=t.filter(m=>m.payment_method===h)),t.sort((m,o)=>{let S=m[r],k=o[r];return r==="date"?(S=new Date(S).getTime(),k=new Date(k).getTime()):r==="amount"?(S=Number(S),k=Number(k)):(S=String(S).toLowerCase(),k=String(k).toLowerCase()),g==="asc"?S>k?1:-1:S<k?1:-1}),t},[x,c,p,h,r,g]),N=Math.ceil(d.length/j),E=d.slice((y-1)*j,y*j),B=t=>{r===t?_(g==="asc"?"desc":"asc"):(u(t),_("desc")),f(1)},P=()=>{s(""),i(""),v(""),u("date"),_("desc"),f(1)},T=({field:t,children:m})=>e.jsxs("button",{onClick:()=>B(t),className:"flex items-center gap-1 hover:text-primary-600 transition-colors",children:[m,r===t&&(g==="asc"?e.jsx(Y,{size:14}):e.jsx(ee,{size:14}))]}),U=()=>e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((t,m)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/5"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"})]},m))})}),L=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No expenses found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm",children:c||p||h?"No expenses match your current filters.":"Get started by adding your first expense."}),(c||p||h)&&e.jsx(b,{variant:"outline",size:"sm",onClick:P,className:"mt-3",children:"Clear Filters"})]}),$=()=>N<=1?null:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(y-1)*j+1," to ",Math.min(y*j,d.length)," of ",d.length," expenses"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>f(t=>Math.max(1,t-1)),disabled:y===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",y," of ",N]}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>f(t=>Math.min(N,t+1)),disabled:y===N,children:"Next"})]})]});return e.jsxs(O,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Expense Records"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(J,{size:16}),d.length," of ",x.length," expenses"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"}),e.jsx(F,{id:"search-expenses",placeholder:"Search expenses...",value:c,onChange:t=>{s(t.target.value),f(1)},className:"pl-10"})]}),e.jsx(z,{id:"category-filter",label:"",options:w,value:p,onChange:t=>{i(t.target.value),f(1)},placeholder:"All Categories"}),e.jsx(z,{id:"payment-method-filter",label:"",options:a,value:h,onChange:t=>{v(t.target.value),f(1)},placeholder:"All Payment Methods"}),e.jsx(b,{variant:"outline",onClick:P,className:"w-full",children:"Clear Filters"})]})]}),C?e.jsx(U,{}):e.jsxs("div",{children:[e.jsx("div",{className:"md:hidden p-4 space-y-3",children:E.length>0?E.map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-bold text-gray-800 dark:text-white",children:t.paid_to}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{variant:"icon",size:"sm",onClick:()=>M(t),title:"Edit",children:e.jsx(q,{size:16})}),e.jsx(b,{variant:"icon",size:"sm",onClick:()=>n(t),title:"Delete",children:e.jsx(I,{size:16,className:"text-red-500"})})]})]}),e.jsxs("p",{className:"font-bold text-lg text-red-500 dark:text-red-400 mb-2",children:["â‚¹",t.amount.toLocaleString("en-IN")]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:14})," ",t.expense_type]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(H,{size:14})," ",t.payment_method]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(K,{size:14})," ",new Date(t.date).toLocaleDateString("en-GB")]}),t.notes&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 text-sm",children:t.notes})]})]},t.id)):e.jsx(L,{})}),e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsx(T,{field:"date",children:"Date"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsx(T,{field:"paid_to",children:"Paid To"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsx(T,{field:"expense_type",children:"Category"})}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700 dark:text-gray-300",children:e.jsx(T,{field:"amount",children:"Amount"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Payment Method"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Notes"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700 dark:text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:E.length>0?E.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:t.paid_to}),e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-600 rounded-full text-xs",children:t.expense_type})}),e.jsxs("td",{className:"px-4 py-3 font-bold text-red-500 dark:text-red-400 text-right",children:["â‚¹",t.amount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:t.payment_method}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-400 max-w-xs",children:t.notes?e.jsx("span",{className:"truncate block\\",title:t.notes,children:t.notes}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>M(t),title:"Edit expense",children:e.jsx(q,{size:14})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>n(t),title:"Delete expense",children:e.jsx(I,{size:14})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:e.jsx(L,{})})})})]})}),e.jsx($,{})]})]})},ie=({isOpen:x,onClose:C,onSave:M,editingExpense:n})=>{const{userProfile:c}=R(),[s,p]=l.useState({date:new Date().toISOString().split("T")[0],expense_type:"",paid_to:"",amount:"",payment_method:"Cash",notes:""}),[i,h]=l.useState(!1),[v,r]=l.useState(null);l.useEffect(()=>{x&&(p(n?{date:n.date,expense_type:n.expense_type,paid_to:n.paid_to,amount:String(n.amount),payment_method:n.payment_method,notes:n.notes||""}:{date:new Date().toISOString().split("T")[0],expense_type:"",paid_to:"",amount:"",payment_method:"Cash",notes:""}),r(null))},[x,n]);const u=j=>{const{id:w,value:a}=j.target;p({...s,[w]:a}),v&&r(null)},g=()=>s.date?s.expense_type?s.paid_to.trim()?!s.amount||parseFloat(s.amount)<=0?"Amount must be greater than zero":s.payment_method?null:"Payment method is required":"Paid to field is required":"Expense type is required":"Date is required",_=async j=>{j.preventDefault(),r(null);const w=g();if(w){r(w);return}h(!0);try{const a={date:s.date,expense_type:s.expense_type,paid_to:s.paid_to.trim(),amount:parseFloat(s.amount),payment_method:s.payment_method,notes:s.notes.trim()||void 0};await M(a);const d=(c==null?void 0:c.name)||"Admin",N=n?`Updated an expense of â‚¹${a.amount.toLocaleString("en-IN")} for "${a.expense_type}"`:`Added a new expense: â‚¹${a.amount.toLocaleString("en-IN")} for "${a.expense_type}" paid to ${a.paid_to}`;await se(N,d),C()}catch(a){r(a.message||"Failed to save expense")}finally{h(!1)}},y=[{value:"Rent",label:"Rent"},{value:"Utilities",label:"Utilities"},{value:"Materials",label:"Materials"},{value:"Equipment",label:"Equipment"},{value:"Maintenance",label:"Maintenance"},{value:"Salaries",label:"Salaries"},{value:"Transportation",label:"Transportation"},{value:"Marketing",label:"Marketing"},{value:"Office Supplies",label:"Office Supplies"},{value:"Miscellaneous",label:"Miscellaneous"}],f=[{value:"Cash",label:"Cash"},{value:"Credit Card",label:"Credit Card"},{value:"Debit Card",label:"Debit Card"},{value:"Bank Transfer",label:"Bank Transfer"},{value:"UPI",label:"UPI"},{value:"Check",label:"Check"}];return e.jsx(te,{isOpen:x,onClose:C,title:n?"Edit Expense":"Add New Expense",size:"lg",children:e.jsxs("form",{onSubmit:_,className:"space-y-4 pt-2",children:[v&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md text-sm",children:[e.jsx(V,{size:18}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{id:"date",label:"Date *",type:"date",value:s.date,onChange:u,required:!0,disabled:i}),e.jsx(z,{id:"expense_type",label:"Expense Type *",options:y,value:s.expense_type,onChange:u,required:!0,disabled:i,placeholder:"Select expense type"})]}),e.jsx(F,{id:"paid_to",label:"Paid To *",value:s.paid_to,onChange:u,required:!0,disabled:i,placeholder:"e.g., TNEB, Vendor Name, Employee Name"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{id:"amount",label:"Amount (â‚¹) *",type:"number",step:"0.01",min:"0.01",value:s.amount,onChange:u,required:!0,disabled:i,placeholder:"e.g., 5000"}),e.jsx(z,{id:"payment_method",label:"Payment Method *",options:f,value:s.payment_method,onChange:u,required:!0,disabled:i})]}),e.jsx(ae,{id:"notes",label:"Notes (Optional)",value:s.notes,onChange:u,disabled:i,placeholder:"Any additional details about this expense...",rows:3}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(b,{type:"button",variant:"outline",onClick:C,disabled:i,children:"Cancel"}),e.jsx(b,{type:"submit",variant:"primary",disabled:i,children:i?e.jsx(G,{className:"w-5 h-5 animate-spin"}):n?"Update Expense":"Save Expense"})]})]})})},_e=()=>{const[x,C]=l.useState([]),[M,n]=l.useState(!0),[c,s]=l.useState(null),[p,i]=l.useState(!1),[h,v]=l.useState(!1),[r,u]=l.useState(null),g=l.useCallback(async()=>{n(!0);try{const{data:a,error:d}=await D.from("expenses").select("*").order("date",{ascending:!1});if(d)throw d;C(a||[])}catch(a){A.error(a.message||"Failed to fetch expenses.")}finally{n(!1)}},[]);l.useEffect(()=>{g()},[g]);const _=async a=>{const d=c?D.from("expenses").update(a).eq("id",c.id):D.from("expenses").insert([a]);await A.promise(d,{loading:"Saving expense...",success:`Expense ${c?"updated":"added"} successfully!`,error:E=>E.message||"Failed to save expense."});const{error:N}=await d;N||(i(!1),s(null),g())},y=a=>{s(a),i(!0)},f=a=>{u(a),v(!0)},j=async()=>{if(!r)return;const a=D.from("expenses").delete().eq("id",r.id);await A.promise(a,{loading:"Deleting expense...",success:"Expense deleted successfully.",error:N=>N.message||"Failed to delete expense."});const{error:d}=await a;d||g(),v(!1),u(null)},w=l.useMemo(()=>x.reduce((a,d)=>a+d.amount,0),[x]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsx(W,{position:"top-right"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"ðŸ’¸ Expenses"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Track and manage all your expenses."})]}),e.jsxs(b,{onClick:()=>{s(null),i(!0)},className:"w-full sm:w-auto",children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," Add Expense"]})]}),e.jsx(O,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Expenses Logged"}),e.jsxs("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:["â‚¹",w.toLocaleString("en-IN")]})]})}),e.jsx(ne,{expenses:x,loading:M,onEdit:y,onDelete:f}),e.jsx(ie,{isOpen:p,onClose:()=>i(!1),onSave:_,editingExpense:c}),e.jsx(re,{isOpen:h,onClose:()=>v(!1),onConfirm:j,title:"Confirm Deletion",description:`Are you sure you want to delete this expense? (${r==null?void 0:r.expense_type} - â‚¹${r==null?void 0:r.amount})`,confirmText:"Delete"})]})};export{_e as default};
